name: Publish documentation
on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  publish:
    runs-on: ubuntu-latest
    environment: github-pages

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Publish doc
        working-directory: ~/gh_doc_automation
        shell: bash

        env:
          GH_NAME: ap-github                        # can be anything
          GH_EMAIL: ap-github@wise.com              # can be anything
          GH_TOKEN:  ${{ secrets.GITHUB_TOKEN }}     # Comes from GH itself, available at runtime, not stored in secrets
        run: |
          ./scripts/ci_check_no_file_changes.sh doc && rc=$? || rc=$?

          if [[ $rc -eq 1 ]]
          then
            scripts/publish_docs.sh
          fi
